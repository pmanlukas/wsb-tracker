# Development Dockerfile with hot reload
FROM python:3.12-slim

WORKDIR /app

# Install system dependencies including Node.js
RUN apt-get update && apt-get install -y --no-install-recommends \
    gcc \
    curl \
    && curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && rm -rf /var/lib/apt/lists/*

# Copy Python package files
COPY pyproject.toml ./
COPY wsb_tracker/ ./wsb_tracker/

# Install Python dependencies
RUN pip install --no-cache-dir -e ".[api,ticker-info,dev]"

# Copy frontend and install dependencies
COPY frontend/package*.json ./frontend/
RUN cd frontend && npm ci

COPY frontend/ ./frontend/

# Create data directory
RUN mkdir -p /data

# Environment variables
ENV WSB_DB_PATH=/data/wsb_tracker.db
ENV PYTHONUNBUFFERED=1

# Expose ports for API and Vite dev server
EXPOSE 8000 5173

# Development startup script
COPY docker-entrypoint-dev.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/docker-entrypoint-dev.sh

CMD ["docker-entrypoint-dev.sh"]
